---
title: "Toronto Police Break and Enter Data Analysis"
author: "Adele, Wayne, Alexandra, Andrei & Cindy, TUT0201, Group 4"
subtitle: "The subtitle of my project"
date: March 30, 2020
output: 
  beamer_presentation:
    theme: "Pittsburgh"
    colortheme: "orchid"
    fonttheme: "serif"
    slide_level: 2
---



```{r, echo=FALSE, message=FALSE, warning=FALSE}
# echo=FALSE will stop the code chunk from appearing in the knit document
# warning=FALSE and message=FALSE will stop R messages from appearing in the knit document
library(tidyverse)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load the TPS break in data
break_and_enters <- read_csv("break_and_enters.csv")
```


## Introduction

The offence of break and enter encompasses situations where individuals tresspass or attempt to trespass on private enclosed property. 

Though break and enters are not the most violent crimes, the preventative measures for such offenses can be exhaustive and costly--alarm systems, surveillance cameras, security teams, etc. In order to ensure adequate protection of vulnerable spaces and appropriate usage of resources, it is important to understand the spatial and temporal patterns of break and enters. 

The data used to analyze these patterns comes from the Toronto Police Service, and includes reported break and enters from 2014-2019. 

## Objectives

Our main question which we seek to answer is: **"In neighborhoods with high B&E rates, what are the commonalities between the crimes?"** 
We then divided this question into a series of smaller subquestions, focused on specific variables:

* Are particular premise types more susceptible to B&E’s in high-risk compared to low-risk neighborhoods? 

* Is there a particular day of the week or hour of the day that inhabitants should be more wary of B&E’s? 

* Is there a certain kind of B&E that occurs more often in these high-rate neighborhoods?

## Objectives Continued
Using the data given to us by the TPS, we want to understand commonalities between offenses in the neighborhoods that experience the highest proportion of break-and-enters. The purpose of doing so is to help the TPS understand the characteristics of B&E offences in vulnerable neighborhoods in order to allocate officers and other resources efficiently to reduce crime across the city. 
Once these strategies are implemented, it is likely that the city will change and different neighborhoods will become hotbeds for B&E's. Hopefully, once a strategy is developed for high-risk neighborhoods, it can be transplanted and altered slightly to work elsewhere.  

We hypothesize that premise type, as well as temporal trends such as time of day/day of the week, influences vulnerability in high-risk neighborhoods. Furthermore, we expect that these neighborhoods might experience a higher density of B&E with intent. 

## Data Summary 

We first created a new variable for each offence based off of the neighborhood it occurred in, called *prop*, which represented the proportion of all break and enters that occurred in that neighborhood. We then created a boxplot and a corresponding summary table to help us understand how the proportions were distributed. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# echo=FALSE will stop the code chunk from appearing in the knit document
# warning=FALSE and message=FALSE will stop R messages from appearing in the knit document
grouped_hood <- break_and_enters %>% 
  filter(!is.na(Neighbourhood)) %>%
  group_by(Neighbourhood) %>%
  mutate(number = n()) %>%
  mutate(prop = number/43302)
break_and_enters_prop <- merge(break_and_enters,grouped_hood,by=c("X1", "Index", "event_unique_id", "occurrencedate", "reporteddate", "premisetype", "offence", "reportedyear", "reportedmonth", "reportedday", "reporteddayofyear", "reporteddayofweek", "reportedhour", "occurrenceyear", "occurrencemonth", "occurrenceday", "occurrencedayofyear", "occurrencedayofweek", "occurrencehour", "MCI", "Division", "Hood_ID", "Long", "Lat"))
```
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=1.5}
ggplot(break_and_enters_prop,
aes(x = "", y=prop)) + xlab("Proportion of total break-ins that occurred in observation's 
                            neighborhood") +
geom_boxplot()
```
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=0.25, fig.height=0.25}
break_and_enters_prop %>%
summarise(
Q1=quantile(prop, 0.25),
med=median(prop),
Q3=quantile(prop, 0.75),
max=max(prop))
```

---
## Data Summary Continued
We were interested in the extremes of this data--in other words, neighborhoods that were high-risk and neighborhoods that were low-risk. This allows us look at data that is "extreme"--those with proportions <= the first quartile, and those >= the third (aka, the bottom 25% and the top 25% neighborhoods).


## Statistical Methods

Describe here what you have done to the data without presenting any results (output). If you want to indicate variables by symbols or variable names, define them here. 
Subquestion 1: Hypothesis Test for Difference in Proportions and Linear Regression

## Results--Subquestion 1:

Upon initial observation, we noticed that the proportion of commercial break-ins in high-risk neighborhoods appeared much larger than commercial break-ins in low-risk neighborhoods. This was tested using a difference of proportions hypothesis test, using the following hypotheses: 

\tiny Upon initial observation, we noticed that the proportion of commercial break-ins in high-risk neighborhoods appeared much larger than commercial break-ins in low-risk neighborhoods. This was tested using a difference of proportions hypothesis test, using the following hypotheses: 

$H_0:p_H = p_L$ & $H_A:p_H \neq p_L$,
where $p_H , p_L$ are the proportion of commercial break-ins that happened in high- and low-risk neighborhoods, respectively. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=0, fig.height=0}
b_and_e_top <- break_and_enters_prop %>%
  filter(prop >= 0.01457208)
b_and_e_lower <- break_and_enters_prop %>%
  filter(prop <= 0.005565563)
b_and_e_extremes <- rbind(b_and_e_top, b_and_e_lower)
b_and_e_extremes <- b_and_e_extremes %>% mutate(level = ifelse(prop >= 0.01457208, "high", "low"))
set.seed(100)
prop_data <- b_and_e_extremes %>% group_by(level) %>%
summarise(n_commercial = sum(premisetype=="Commercial"),
n=n(),
prop_commercial = n_commercial / n)
test_stat <- prop_data %>%
summarise(test_stat = diff(prop_commercial)) %>%
as.numeric()
repetitions <- 1000; # number of repetitions (i.e. possible groupings)
simulated_values <- rep(NA, repetitions); # empty vector for sim. values
for(i in 1:repetitions){
simdata <- b_and_e_extremes %>%
mutate(level = sample(level)) %>%
group_by(level) %>%
summarise(n=n(),
n_commercial = sum(premisetype=="Commercial"),
prop_commercial = n_commercial / n)
sim_prop_diff <- simdata %>% summarise(value = diff(prop_commercial))
simulated_values[i] <- as.numeric(sim_prop_diff)
}
sim <- tibble(prop_diff = simulated_values)

b_and_e_extremes %>% group_by(level) %>%
summarise(n=n(),
n_commercial = sum(premisetype=="Commercial"),
prop_commercial = n_commercial / n)
prop_data <- b_and_e_extremes %>% group_by(level) %>%
summarise(n_commercial = sum(premisetype=="Commercial"),
n=n(),
prop_commercial = n_commercial / n)
test_stat <- prop_data %>%
summarise(test_stat = diff(prop_commercial)) %>%
as.numeric()
test_stat

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=1.5}
ggplot(sim, aes(x=prop_diff)) +
geom_histogram(binwidth = 0.005, fill="gray", color="black") +
labs(x = "Difference in proportion of commercial breakins for H/LR neighborhoods, 
     assuming no difference between groups") + 
  geom_vline(xintercept=c(test_stat, -test_stat), color="red")
```

Given the low p value of p < 0.0001, we can conclude that there is strong evidence against the null that states that $p_H = p_L$. Therefore, we have reason to believe that the proportion of commercial breakins in these high-rate neighborhoods is different than low-rate neighborhoods. 

## Results--Subquestion 1 Continued: 

This same question can be analyzed through a different lense: linear regression. For this method, a new variable **residential** was created that took the value *"Yes"* if the premise was a house or apartment, and *"No"* if it was anything else. 

\tiny This same question can be analyzed through a different lense: linear regression. For this method, a new variable **residential** was created that took the value *"Yes"* if the premise was a house or apartment, and *"No"* if it was anything else. 

The equation we are testing is $prop_i = \beta_0 + \beta_1 I(premise\ is\ residential) + \epsilon_i$. In other words, we are seeing if whether a property is residential makes it more vulnerable to break-ins (vulnerability approximated by **prop**)
We are interested in testing $H_0: \beta_1 = 0$ vs $H_A: \beta_1 \neq 0$

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=4, fig.height=1}
b_and_e_top <- b_and_e_top %>% mutate(residential = ifelse(premisetype == "House" | premisetype == "Apartment", "Yes", "No")) 
summary(lm(prop ~ residential, data=b_and_e_top))$coefficients
```
Based on the fitted regression model, the p-value corresponding to this hypothesis test is very small (the
estimated p-value from R is 0.001258903), so we have very strong evidence to reject the null hypothesis and
conclude that there is an association between a property being residential and proportion of neighborhood breakins, and the negative coefficient for $\beta_1$ suggests that if a property **is** residential, the **vulnerability** of that property will be lower than if it isn't residential. 

## Results--Subquestion 1 Continued: 
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=4, fig.height=1}
set.seed(1210); n <- nrow(b_and_e_top)
training_indices <- sample(1:n, size=round(0.8*n))
train <- b_and_e_top[training_indices,]; y_train <- train$prop;
# Testing dataset includes all observations NOT in the training data
test <- b_and_e_top[-training_indices,]; y_test <- test$prop;
# Fit models to training data
modB_train <- lm(prop ~ residential, data=train)
# Make predictions for testing data using training model
yhat_modB_test <- predict(modB_train, newdata = test)
# Make predictions for training data using training model
yhat_modB_train <- predict(modB_train, newdata = train)
# Calculate RMSE for testing data
modB_test_RMSE <- sqrt(sum((y_test - yhat_modB_test)^2) / nrow(test))
# Calculate RMSE for training data
modB_train_RMSE <- sqrt(sum((y_train - yhat_modB_train)^2) / nrow(train))
tibble(
RMSE_testdata = c(modB_test_RMSE),
RMSE_traindata = c(modB_train_RMSE),
ratio_of_RMSEs = RMSE_traindata / RMSE_testdata)
```

The Root Mean Squared Error measures prediction error for predictions from a linear regression model. Splitting the data up into testing (20%) and training (80%), we see that the RSME for both is around 0.006. Therefore, on average, predicted **vulnerabilities** (or proportions) are about 0.006 away from the true value in this data set restricted to high-risk neighborhoods. 

The Root Mean Squared Error measures prediction error for predictions from a linear regression model. Splitting the data up into testing (20%) and training (80%), we see that the RSME for both is around 0.006. In other words, the prediction error for this model is 0.006. 





## Conclusion

Give your main conclusions here. Follow the order of questions you presented. 

Here you can also mention any additional considerations, concerns, or issues you might have. For example, if the results were unexpected, you can discuss this and perhaps offer possible explanations.

## Acknowledgements (optional)

If you received any help from someone other than your team members you can acknowledge them. For example:   
*The authors would like to thank "TA name" for helpful suggestions and comments that improved the presentation of this poster.*


